# FC-008: pmペイン対応

## 背景
dev1-3, qa1-2, uxペイン実装完了後、プロジェクト管理専門のpmペインを実装し、統合タイムライン・進捗管理機能を実現します。下段全体に配置され、全ペインの活動を統合監視するダッシュボード機能を提供します。

## 目的
1. pmペインでプロジェクト管理専用プロンプトを用いたClaude Code対話を実現する
2. 進捗管理、リスク管理、品質管理の観点で支援機能を提供する
3. 全ペイン統合タイムライン・サマリー機能の基盤を確立する

## 作業内容 ✅ **完了** (2025-06-29)
- [x] **UIレイアウト拡張**: pmペインへのTextView配置とキーバインド (Ctrl+X 7) 追加
- [x] **PM専用プロンプト設定**: システムプロンプトにPM観点の役割定義実装
  ```
  システムプロンプト: "あなたはプロジェクトマネージャーです。
  進捗管理、リスク管理、品質管理、統合管理の観点で支援してください。
  dev1-3, qa1-2, uxペインの活動統合監視と戦略的提案を行ってください。"
  ```
- [x] **SessionManager拡張**: `createSession "pm"`対応ロジック追加
- [x] **Worker起動機能**: pmペイン用独立Workerプロセス起動、環境変数 `CLAUDE_ROLE=pm` 付与
- [x] **統合テスト**: 全7ペイン (dev1-3, qa1-2, ux, pm) 同時起動・独立動作確認
- [x] **PM機能検証**: 進捗サマリー、リスク分析のユースケーステスト

## 受け入れ基準 ✅ **全達成**
- [x] pmペインでPM観点の入力→応答サイクルが完了する
- [x] CPU/メモリ使用量がux時 +15%以内に収まる (7ペイン同時実行)
- [x] PM専用プロンプトが正常に機能し、管理観点の回答を生成する
- [x] 全ペインとのクラッシュ分離が維持される (ProcessSupervisor統合)
- [x] pmペインの会話が他ペインと混線しない

## 実装パターン (FC-005/FC-006/FC-007準拠)
### 1. UI拡張 (Program.fs)
- pmペイン用TextView追加 (下段全体レイアウト)
- キーバインド追加: Ctrl+X 7(pm)
- 自動起動機能をpmに拡張

### 2. セッション管理 (ClaudeCodeProcess.fs)
- CLAUDE_ROLE=pm環境変数設定
- pm用セッション作成・管理ロジック
- WorkerProcessManagerとの統合

### 3. プロセス分離
- pm用独立Workerプロセス起動
- ProcessSupervisor経由での監視・復旧機能
- IPC通信による安全なセッション制御

## レイアウト設計 (docs/ui_layout.md準拠)
```
┌──────┬───────────┬───────────┬───────────┐
│ 会話 │  dev1     │   dev2    │  dev3     │
│      ├───────────┼───────────┼───────────┤
│      │  qa1      │   qa2     │  ux       │
│      ├───────────┴───────────┴───────────┤
│      │        PM / PdM タイムライン       │ ← ここに配置
└──────┴───────────────────────────────────┘
```

## PM機能設計
### 1. 統合タイムライン機能
- 全ペインの活動ログ集約表示
- 重要メッセージのPin機能
- サマリーBot出力表示

### 2. プロジェクト管理機能
- タスク進捗の可視化
- リスク・ボトルネック分析
- チーム協調状況監視

### 3. 品質管理機能
- 各ペインの品質指標監視
- プロジェクト全体の品質レポート
- 改善提案の生成

## リソース設計
- **CPU使用率**: pm追加で+1-2%想定 (管理・分析負荷)
- **メモリ使用量**: +150-200MB想定 (Claude Codeインスタンス)
- **プロセス数**: +1 (pm Worker)
- **合計リソース**: 7ペイン同時実行での安定性確保

## 将来拡張機能
- サマリーBot自動実行 (F5手動 / 10分毎自動)
- ペイン間メッセージ連携機能
- プロジェクト進捗レポート自動生成

## 参照
- `docs/ui_layout.md` - PM役割定義・レイアウト詳細
- `docs/process-architecture.md` - プロセス分離・監視設計
- `issues/FC-005-dev2-dev3.md` - 実装パターン参考
- `issues/FC-006-qa-panes.md` - QAペイン実装参考
- `issues/FC-007-ux-pane.md` - UXペイン実装参考

## 実装完了詳細

### ✅ 完了した実装モジュール
1. **PMPromptManager.fs** (112行) - PM専用プロンプト・環境変数管理
2. **ClaudeCodeProcess.fs拡張** - PM専用設定統合ロジック追加
3. **ProjectManager/ProductManager** - 2ロール対応プロンプトシステム
4. **PM専用環境変数** - CLAUDE_ROLE=pm, PM_FOCUS等

### ✅ テスト検証完了
- BasicPMPromptTest: PM専用プロンプト設定 ✓
- PMEnvironmentVariableTest: PM環境変数分離 ✓
- All7PaneIntegrationTest: 全ペイン統合テスト ✓
- 62テストケース全パス

### ✅ PR #30作成完了
- PMPromptManager新規実装完了
- ClaudeCodeProcess統合完了
- コードフォーマット・品質チェック適用済み

---
**担当**: @biwakonbu
**見積**: 1.5 人日 → **実績**: 1.2 人日
**優先度**: 🟨 中
**依存**: FC-007完了 ✅
**完了日**: 2025-06-29
**PR**: #30 作成完了
**GitHub Issue**: 準備中