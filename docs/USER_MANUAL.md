# fcode ユーザーマニュアル

**バージョン**: 1.0.0  
**対象ユーザー**: F#/.NET開発者、TUIエディタ利用者、Claude Code活用開発者

## 目次

1. [概要](#概要)
2. [インストール](#インストール)
3. [基本操作](#基本操作)
4. [マルチペイン活用](#マルチペイン活用)
5. [AIチーム協調ワークフロー](#aiチーム協調ワークフロー)
6. [設定とカスタマイズ](#設定とカスタマイズ)
7. [トラブルシューティング](#トラブルシューティング)

## 概要

fcodeは、Claude Codeを最大限活用するための専用TUIラッパーです。複数のClaude Codeインスタンスを同時起動し、役割分担されたAIチームによる協調開発を実現します。

### 主な特徴

- **9ペイン構成**: 会話ペイン + 開発チーム（dev1-3）+ QAチーム（qa1-2）+ UXデザイナー + PM + PdM
- **役割分担AIシステム**: 各ペインに専門特化したAIアシスタントを配置
- **Emacsライクキーバインド**: 効率的なペイン間移動とコマンド実行
- **リアルタイム協調**: ペイン間でのコンテキスト共有と連携作業
- **セッション永続化**: 作業状態の保存と復元（tmuxライク機能）

## インストール

### 前提条件

1. **Claude Code CLI**: ローカルにインストール済みであること
2. **実行環境**: Linux または macOS
3. **.NET 8**: F#実行環境

### インストール手順

```bash
# リポジトリクローン
git clone <repository-url>
cd fcode

# ビルド
dotnet build src/fcode.fsproj -c Release

# シングルファイル実行可能ファイル生成
dotnet publish src/fcode.fsproj -c Release -r linux-x64 --self-contained true -p:PublishSingleFile=true

# 実行可能ファイルをPATHに追加
sudo cp src/bin/Release/net8.0/linux-x64/publish/fcode /usr/local/bin/
```

### 初回セットアップ

```bash
# 初回起動（設定ファイル自動生成）
fcode

# Claude Code CLIのパス確認
which claude
```

## 基本操作

### 起動と終了

```bash
# 起動
fcode

# 終了
Ctrl+X Ctrl+C
```

### 基本キーバインド

| キーシーケンス | 機能 | 説明 |
|---|---|---|
| `Ctrl+X Ctrl+C` | アプリケーション終了 | 全セッションを安全に終了 |
| `Ctrl+X O` | 次のペインに移動 | ペインを順次切り替え |
| `Ctrl+X Ctrl+O` | 前のペインに移動 | 逆順でペイン切り替え |
| `Ctrl+L` | UI更新 | 画面を再描画 |
| `Ctrl+X H` | ヘルプ表示 | 操作ガイドを表示 |

### ペイン直接移動

| キー | 移動先 | 役割 |
|---|---|---|
| `Ctrl+X 0` | 会話ペイン | チーム間コミュニケーション |
| `Ctrl+X 1` | dev1ペイン | シニアエンジニア |
| `Ctrl+X 2` | dev2ペイン | エンジニア |
| `Ctrl+X 3` | dev3ペイン | エンジニア |
| `Ctrl+X 4` | qa1ペイン | テストリード |
| `Ctrl+X 5` | qa2ペイン | ヒューリスティックテスト |
| `Ctrl+X 6` | uxペイン | UI/UXデザイナー |
| `Ctrl+X 7` | pmペイン | プロジェクトマネージャー |
| `Ctrl+X 8` | pdmペイン | プロダクトマネージャー |

### Claude Code操作

| キーシーケンス | 機能 | 説明 |
|---|---|---|
| `Ctrl+X S` | Claude Code起動 | 現在のペインでClaude起動 |
| `Ctrl+X K` | Claude Code終了 | 現在のペインのClaude終了 |

## 開発フロー：スクラム風ターン制開発

### 基本的な開発サイクル

fcodeはスクラムを模倣したターン制開発を採用します：

#### 1. SMTG（スプリントミーティング）
**目的**: 次スプリントのタスク決定と仕様調整

**手順**:
1. **バックログ洗い出し・整理**（毎回実施）:
   - **新規課題収集**:
     - **dev1-3**: 技術課題・アーキテクチャ改善点
     - **qa1-2**: 品質課題・テスト改善点
     - **ux**: ユーザー体験改善・KPI課題
     - **pm**: プロセス改善・メトリクス課題
     - **pdm**: 品質向上・ユーザー受け入れ課題
     - 疑問点・不明点の共有と整理
   - **バックログ整理**:
     - 新たなタスクとしてバックログに追加
     - 重複タスクの統合・削除
     - 状況変化により不要になったタスクの削除
     - 既存タスクの優先度見直し・再順位付け（ユーザー価値インパクトに基づく重複なしの順序で設定）
2. **次スプリント機能決定・タスク選択**:
   - POがユーザー価値インパクトに基づく優先順位で次スプリントで開発する機能を決定
   - 機能単位のタスク（ユーザー価値提供重視）をバックログから選択
   - 必要に応じて雑務タスクも含めるが、機能開発を最優先
   - 選択したタスクをスプリントボードに積み込み
3. **仕様明確化**: PMが「何を・なぜ・どの程度・どう検証」を明確化
4. **仕様のチケット記載**: 全ての仕様をタスク（チケット）に詳細記載
5. **タスク粒度調整**: 1-2スタンドアップMTG（6-12分）でPRまで完了できるサイズに分割
6. **ベロシティ参照**: 直近4スプリントの平均ベロシティを参考に次スプリントのSP総量を決定
7. **スプリントゴール設定**: 全員で合意形成

#### 2. スプリント実行（3vd = 現実時間72分）

**仮想時間システム**:
- **スプリント期間**: 3vd（3仮想日）= 72vh（72仮想時間）= 現実時間72分
- **時間単位**: 1vh = 現実時間1分
- **スタンドアップMTG**: 6vh毎（現実時間6分毎）に実施、計12回
- **時間管理**: PMが全て担当、72分経過で強制的に作業ストップ→RMTG突入
- **仕様管理**: スプリント中の仕様はチケットが唯一の信頼できるソース

**重要な注意事項**:
- **ドキュメントの信頼性**: UX・PdM・PMが常時更新しているため、スプリント中は参考程度
- **仕様の正式ソース**: スプリント中はチケット（タスク）に記載された仕様のみが正式
- **開発者の注意点**: ドキュメントではなく、必ずチケットの仕様を参照して作業

#### GitHub Issues管理システム

**チケット管理の基本**:
- **全タスクチケット化**: GitHub issuesで全タスクを管理
- **カンバンボード**: GitHub Project Boardsでタスクの進行状況を可視化
- **進捗の透明性**: 全メンバーがリアルタイムで進捗状況を把握可能

**Issue更新ルール**:
1. **スタンドアップMTG前更新（必須）**:
   - 6分毎のスタンドアップMTG開始前に必ず作業状況をissueに記載
   - 進捗率、完了したタスク、現在の課題をコメントで更新
2. **リアルタイム更新**:
   - 重要な進捗や問題発生時は即座にissue更新
   - ブロッカー発生時は優先的に記載
3. **カンバン移動**:
   - 作業フェーズ変更時にカードを移動（To Do → In Progress → Review → Done）
   - ステータス変更時は理由・詳細をコメントで説明

**Issue記載内容**:
- **進捗状況**: 何をどこまで完了したか
- **現在の作業**: 何に取り組んでいるか
- **課題・ブロッカー**: 困っていること、阻害要因
- **次のステップ**: 次に予定している作業
- **所要時間**: 作業にかかった時間・予想残り時間

**タスク粒度の原則**:
- **時間目安**: 1-2スタンドアップMTG（6-12分）でPRまで完了
- **分割方針**: 
  - 大きなタスクは小さな単位に分割
  - 各タスクは独立してPR可能な状態
  - 機能の一部でも価値提供できる単位
- **利点**:
  - 仕様変更への迅速な対応
  - コンフリクトリスクの軽減
  - 継続的インテグレーションの実現
  - レビューの効率化
- **注意点**: 
  - 過度な細分化は避ける
  - ユーザー価値を保持した分割
  - 依存関係を考慮した順序

##### スタンドアップMTG（6vh毎）
**実施タイミング**: 現実時間6分毎（6vh, 12vh, 18vh... 72vh時点）
**時間**: 時間制限なし（ただし短めに実施）
**進行**: PMが全て管理・進行（POは参加しない）
**開始手順**:
1. PMがタイマーで現実時間を計測
2. 6分経過時刻になったらPMが各員に連絡
3. 各作業者がGitHub issueに作業状況を反映（必須）
4. 全員が作業を停止してスタンドアップ開始
5. 報告順序: dev1→dev2→dev3→qa1→qa2→ux→pdm→pm（最後）

**各メンバーの報告内容**:
1. **現作業の進捗報告**: 何をやっているか、どこまで進んでいるか
2. **方向性共有**: 作業の方向性が正しいか、目標との整合性確認
3. **問題点・課題の共有**: 認識している問題や新たに発生した課題

**問題対応フロー（PMが判定）**:
- **ブロッキング問題**: 
  - 担当者の作業を阻害する問題
  - スタンドアップMTG後に関係者MTGを即座に実施
  - 問題解決まで他のタスクに振り替え
- **非ブロッキング問題**: 
  - 作業継続可能な問題
  - バックログに積んで後で対応
  - 現在の作業を継続

**PMの追加役割**: 問題の緊急度判定、関係者MTGセッティング、タスク振り替え判断

##### PMの重要判断フロー
スタンドアップMTGや関係者MTGで重要な判断が必要な場合のプロセス：

**判断が必要な状況**:
- 仕様変更が必要と判明した場合
- タスク自体の中止を検討すべき場合  
- タスクの後回し・優先度変更が必要な場合

**5段階致命度評価**:
- **レベル1（軽微）**: 小規模調整で対応可能
- **レベル2（軽度）**: 仕様調整が必要だが影響は限定的
- **レベル3（中度）**: 複数タスクに影響、スプリント遅延の可能性
- **レベル4（重度）**: スプリント目標に大きな影響、大幅な計画変更が必要
- **レベル5（致命的）**: プロダクト全体に影響、根本的な見直しが必要

**影響度分析項目**:
1. その後のタスクへの影響度と範囲
2. 全体スケジュール・依存関係への影響
3. 現スプリント完遂可能性（継続 / 部分完了 / 困難）
4. 他チームメンバーの作業への波及効果

**対応決定オプション**:
- **継続**: 仕様調整・軽微な変更で対応可能
- **後回し**: バックログに戻し、次スプリント以降で対応
- **中止**: タスク自体を削除・キャンセル

**バックログ戻し時の記録要件**:
- 状況説明の詳細記録（何が起きたか、なぜ判断したか）
- 判断根拠となった資料・データの添付
- 優先度の再設定（ユーザー価値インパクトベース）
- 関連タスクへの影響度メモ・注意事項

**タスク割り当てシステム**:
- **PMによる動的割り当て**: 優先度に基づいて指示待ちキュー（作業者）にタスクを割り当て
- **事前割り当てなし**: SMTGでは担当者を決めず、着手時にPMが指示

**協調作業パターン**:
- **dev1**: アーキテクチャ設計・技術リード
- **dev2/dev3**: 並列実装・定期レビュー
- **qa1/qa2**: テスト戦略・探索的テスト
- **ux**: ユーザー体験設計・KPI計測
- **pm**: 時間管理・ゴール達成度チェック・メトリクス分析・タスク割り当て
- **pdm**: 品質レビュー・定量分析

#### 3. RMTG（レビューミーティング）
**目的**: スプリント成果レビューと次期計画

**手順**:
1. **成果報告**: 各担当者からの詳細報告
2. **受け入れ判定**: POによる最終判断
3. **達成度評価**: PMによる「指示達成 vs ユーザー価値実現」評価
4. **品質評価**: PdMによる品質・ユーザー受け入れ評価
5. **ベロシティ計測**: 完了したSPの集計と記録
6. **改善計画**: 次スプリントへのフィードバック反映

#### ベロシティ管理システム

**ベロシティ計測**:
- **定義**: スプリント中に完了（Done）したタスクのSP合計
- **計測タイミング**: 各スプリント終了時（RMTG内）
- **記録方法**: 
  - 完了タスクのSP合計を算出
  - スプリント履歴として蓄積
  - 直近4スプリントの平均値を自動計算

**次スプリント計画への活用**:
- **基準値**: 直近4スプリント平均ベロシティ
- **安全マージン**: 平均値の80-90%程度でSP総量を設定
- **調整要因考慮**:
  - チームメンバーの状況変化
  - 技術的難易度の変動
  - 外部依存や制約の影響
  - 新機能 vs 既存機能改修の比率

**ベロシティ改善**:
- **トレンド分析**: ベロシティの推移を分析
- **ボトルネック特定**: 完了できなかったタスクの原因分析
- **プロセス改善**: スタンドアップMTGでの改善提案
- **チーム能力向上**: AI開発チームの学習効果測定

## マルチペイン活用

### 画面レイアウト

```
┌──────┬───────────┬───────────┬───────────┐
│ 会話 │  dev1     │   dev2    │  dev3     │
│      ├───────────┼───────────┼───────────┤
│      │  qa1      │   qa2     │  ux       │
│      ├───────────┴───────────┴───────────┤
│      │        PM / PdM 統合エリア        │
└──────┴───────────────────────────────────┘
```

### ペイン比率

- **上段**: 40% - 開発チーム（dev1-3）
- **中段**: 40% - 品質チーム（qa1-2）+ UXデザイナー
- **下段**: 20% - 管理チーム（PM/PdM統合タイムライン）
- **左端**: 60列固定幅 - 会話ペイン（全縦幅）

### 効率的な作業フロー

1. **会話ペイン**で全体方針を共有
2. **dev1（シニア）**でアーキテクチャ設計
3. **dev2/dev3**で並列実装
4. **qa1**でテスト戦略策定
5. **qa2**でヒューリスティックテスト
6. **ux**でユーザビリティ検証
7. **pm**で進捗管理・調整
8. **pdm**で要件・優先順位決定

## AIチーム協調ワークフロー

### 各ペインの役割と特性

#### dev1（シニアエンジニア）
- **責任**: 技術リード、アーキテクチャ設計、最終レビュー
- **特性**: 批判的視点、潜在的問題の指摘、技術水準向上への責任感
- **協調**: dev2/dev3からのレビュー依頼を受付

#### dev2/dev3（エンジニア）
- **責任**: 機能実装、リファクタリング、ユニットテスト
- **特性**: インクリメンタル開発、定期的なシニアレビュー依頼
- **協調**: 並列作業、相互連携、dev1への継続的相談

#### qa1（テストリード）
- **責任**: テスト計画策定、品質ゲート管理
- **特性**: ドキュメント整合性の厳格チェック、仕様逸脱の早期発見
- **協調**: エンジニアへのテスト指示配布、qa2との役割分担

#### qa2（ヒューリスティックテスト）
- **責任**: 創造的テスト、極限状況での品質検証
- **特性**: 突飛な発想、ハードユース、隠れた品質課題の発見
- **協調**: qa1の戦略的テストを補完

#### ux（UI/UXデザイナー）
- **責任**: ユーザー中心設計、利用体験の最適化、KPI設計、計測基盤構築
- **特性**: 開発都合より利用者優先、行動トレース、本質的問題解決、継続的計測
- **協調**: pdmとの密接な協働、KPI・計測基盤の共同設計

#### pm（プロジェクトマネージャー）
- **責任**: 明確なゴール設定、達成度検証、AI開発チーム品質管理、開発メトリクス分析、要件定義、緊急時統制
- **特性**: ユーザー価値実現重視、ゴール曖昧性排除、「何を・なぜ・どの程度・どう検証」の明確化、メトリクス活用したタスク見極め
- **協調**: 全チームの統一認識確立、毎日のゴール達成度レビュー、AI特性を考慮した指示設計、開発メトリクス分析

#### pdm（プロダクトマネージャー）
- **責任**: プロダクト品質レビュー、定量分析、ユーザー受け入れ評価
- **特性**: 厳格な品質評価、定量分析重視、ユーザー満足度・品質指標の数値的分析
- **協調**: UXとの品質向上協働、PMとの品質基準調整、全機能への定量的品質評価

### 推奨ワークフロー例

#### 新機能開発フロー

1. **要件定義フェーズ**
   ```
   pdm → 市場分析・要件整理
   ux → ユーザーニーズ調査
   pm → 作業分解・依存関係整理
   ```

2. **設計フェーズ**
   ```
   dev1 → アーキテクチャ設計・技術方針決定
   qa1 → テスト戦略策定
   ux → UX設計・プロトタイプ
   ```

3. **実装フェーズ**
   ```
   dev2/dev3 → 並列実装（定期的にdev1レビュー）
   qa2 → 実装と並行してヒューリスティックテスト
   pm → 進捗管理・ブロッカー解消
   ```

4. **検証フェーズ**
   ```
   qa1 → 総合テスト実行・品質ゲート判定
   ux → ユーザビリティ検証
   pdm → 定量的評価・リリース判定
   ```

## 設定とカスタマイズ

### 設定ファイル

設定は `~/.config/claude-tui/config.json` に保存されます。

#### 基本設定例

```json
{
  "version": "1.0.0",
  "claudeConfig": {
    "claudeCliPath": null,
    "apiKey": null,
    "projectPath": null
  },
  "uiConfig": {
    "colorScheme": "default",
    "refreshIntervalMs": 100,
    "autoScrollEnabled": true,
    "fontSize": 12
  },
  "resourceConfig": {
    "maxActiveConnections": 8,
    "monitoringIntervalMs": 2000
  }
}
```

### 環境変数による設定オーバーライド

```bash
# Claude CLI パス指定
export CLAUDE_CLI_PATH="/usr/local/bin/claude"

# プロジェクトパス指定
export CLAUDE_PROJECT="/path/to/your/project"

# APIキー指定（通常不要）
export CLAUDE_API_KEY="your-api-key"
```

### キーバインドカスタマイズ

設定ファイル内の `keyBindings` セクションで変更可能：

```json
{
  "keyBindings": [
    {
      "action": "ExitApplication",
      "keySequence": "Ctrl+X Ctrl+C",
      "description": "アプリケーション終了"
    }
  ]
}
```

## トラブルシューティング

### よくある問題

#### 1. Claude Code CLIが見つからない

**症状**: `Claude CLI not found in PATH` エラー

**解決法**:
```bash
# Claude CLIの場所を確認
which claude

# パスを環境変数で指定
export CLAUDE_CLI_PATH="/path/to/claude"

# または設定ファイルで指定
```

#### 2. ペイン表示が崩れる

**症状**: レイアウトが正しく表示されない

**解決法**:
```bash
# UI更新
Ctrl+L

# 端末サイズを確認（最小推奨: 120x30）
echo $COLUMNS x $LINES
```

#### 3. セッションが復元されない

**症状**: 前回の作業状態が失われる

**解決法**:
- 設定ディレクトリの権限確認
- ディスク容量の確認
- ログファイルの確認

### ログとデバッグ

```bash
# ログレベル設定
export LOG_LEVEL=DEBUG

# ログファイル確認
tail -f ~/.config/claude-tui/logs/fcode.log
```

### パフォーマンス最適化

#### メモリ使用量削減
- 不要なペインのClaude Codeを終了
- セッション履歴の定期的なクリア

#### 応答性向上
- RefreshIntervalMsの調整（デフォルト: 100ms）
- MonitoringIntervalMsの調整（デフォルト: 2000ms）

### サポートとフィードバック

- **Issue報告**: [GitHub Issues](repository-url/issues)
- **機能要望**: [GitHub Discussions](repository-url/discussions)
- **コントリビューション**: [CONTRIBUTING.md](../CONTRIBUTING.md)

---

## 付録

### A. 完全キーバインド一覧

| カテゴリ | キー | 機能 |
|---|---|---|
| **基本操作** | | |
| | `Ctrl+X Ctrl+C` | アプリケーション終了 |
| | `Ctrl+L` | UI更新 |
| | `Ctrl+X H` | ヘルプ表示 |
| **ペイン移動** | | |
| | `Ctrl+X O` | 次のペイン |
| | `Ctrl+X Ctrl+O` | 前のペイン |
| | `Ctrl+X 0-8` | 直接ペイン移動 |
| **Claude操作** | | |
| | `Ctrl+X S` | Claude起動 |
| | `Ctrl+X K` | Claude終了 |

### B. 推奨端末設定

- **最小サイズ**: 120x30文字
- **推奨サイズ**: 160x40文字以上
- **カラー**: 256色対応
- **フォント**: 等幅フォント推奨

### C. 互換性情報

- **対応OS**: Linux, macOS
- **非対応**: Windows
- **.NET**: 8.0以上
- **Terminal.Gui**: 1.15.0以上