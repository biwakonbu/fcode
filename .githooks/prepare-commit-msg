#!/bin/bash

# prepare-commit-msg hook: --no-verifyä½¿ç”¨æ™‚ã®è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2

# ã‚«ãƒ©ãƒ¼å‡ºåŠ›ç”¨ã®å®šæ•°
RED='\033[0;31m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# --no-verify ãƒ•ãƒ©ã‚°ãŒä½¿ç”¨ã•ã‚ŒãŸã‹ã‚’æ¤œå‡º
# Git ã¯ --no-verify ä½¿ç”¨æ™‚ã« prepare-commit-msg ã‚’å‘¼ã³å‡ºã™ãŒã€pre-commit ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹
if [ -z "$SKIP_VERIFY_CHECK" ]; then
    # pre-commit ãŒå®Ÿè¡Œã•ã‚ŒãŸã‹ãƒã‚§ãƒƒã‚¯ï¼ˆç’°å¢ƒå¤‰æ•°ã§åˆ¤å®šï¼‰
    if [ -z "$PRE_COMMIT_EXECUTED" ]; then
        # pre-commit ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ = --no-verify ãŒä½¿ç”¨ã•ã‚ŒãŸ
        
        echo -e "${RED}âš ï¸  WARNING: --no-verify ãƒ•ãƒ©ã‚°ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ${NC}" >&2
        echo -e "${YELLOW}" >&2
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" >&2
        echo "ðŸš¨ ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ" >&2
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" >&2
        echo "" >&2
        echo "ã‚³ãƒŸãƒƒãƒˆå‰ã«ä»¥ä¸‹ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦å“è³ªã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ï¼š" >&2
        echo "" >&2
        echo -e "${BLUE}  make check${NC}     # å…¨å“è³ªãƒã‚§ãƒƒã‚¯ (æŽ¨å¥¨)" >&2
        echo "  ã¾ãŸã¯å€‹åˆ¥å®Ÿè¡Œï¼š" >&2
        echo -e "${BLUE}  make format${NC}   # F#ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ" >&2
        echo -e "${BLUE}  make lint${NC}     # ãƒªãƒ³ãƒˆå®Ÿè¡Œ" >&2
        echo -e "${BLUE}  make test${NC}     # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ" >&2
        echo -e "${BLUE}  make build${NC}    # ãƒ“ãƒ«ãƒ‰ç¢ºèª" >&2
        echo "" >&2
        echo -e "${YELLOW}å•é¡ŒãŒç™ºè¦‹ã•ã‚ŒãŸå ´åˆã¯ä¿®æ­£ã—ã¦ã‹ã‚‰å†ã‚³ãƒŸãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚${NC}" >&2
        echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}" >&2
        echo "" >&2
        
        # ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚‚è­¦å‘Šã‚’è¿½åŠ 
        echo "" >> "$COMMIT_MSG_FILE"
        echo "# âš ï¸  WARNING: --no-verify ã§ã‚³ãƒŸãƒƒãƒˆå“è³ªãƒã‚§ãƒƒã‚¯ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ" >> "$COMMIT_MSG_FILE"
        echo "# æ¬¡ã®ã‚³ãƒžãƒ³ãƒ‰ã§å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:" >> "$COMMIT_MSG_FILE"
        echo "#   make check" >> "$COMMIT_MSG_FILE"
        echo "# å•é¡ŒãŒç™ºè¦‹ã•ã‚ŒãŸã‚‰ä¿®æ­£ã—ã¦ git commit --amend ã—ã¦ãã ã•ã„" >> "$COMMIT_MSG_FILE"
    fi
fi