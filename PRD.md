# Product Requirements Document (PRD)

## 1. 目的 (Objective)
Claude Code を最大限活用するための専用 **TUI ラッパー** を提供し、オンライン環境下で高速・快適に AI コーディング支援を受けられる環境を実現する。
+複数の Claude Code インスタンスをペインごとに同時起動し、生成結果を直列に受け渡す "AI パイプライン" を構築することで、コード品質と開発速度の双方を向上させることを目指す。

## 2. 背景 (Background)
- GUI IDE に比べてリソース消費が少なく、リモート開発 (SSH/WSL) でも軽快に動作するツールが求められている。
- Claude Code を統合し、チャット・コード補完・リファクタリング提案をワークフローに組み込みたい。
- 既存の TUI エディタ + AI プラグインではセットアップが煩雑。ワンバイナリ、または簡易インストールで完結する体験を目指す。
- Claude API を直接呼び出すのではなく、公式開発ツール **Claude Code CLI** を内部でラップして提供する。

## 3. チーム構成 & 役割 (Team Composition & Roles)
| ロール | 人数 | 主要責務 |
|--------|-----|-----------|
| Product Manager (PM) | 1 | プロジェクト全体の進行管理、ステークホルダー(依頼者)との調整 |
| Product Designer/Manager (PdM) | 1 | 要件定義、優先順位付け、ユーザーストーリー策定 |
| シニアエンジニア | 1 | 技術的リード、アーキテクチャ設計、コードレビュー最終承認 |
| エンジニア | 2 | 機能実装、リファクタリング、ユニットテスト作成 |
| QA エンジニア | 2 | テスト計画策定・実行、ヒューリスティックテスト、品質ゲート管理 |
| UI/UX デザイナー | 1 | 画面設計、ユーザビリティレビュー |
| ステークホルダー (あなた) | 1 | 要件提示・最終意思決定 |

### QA 方針
- QA チームがテストケースを主導で作成し、エンジニアへ指示を配布する。
- **ヒューリスティックテスト** を積極的に採用し、未知の不具合やユーザビリティ課題を早期発見する。
- Claude Code との連携により、テスト観点リストやバグ再現プロンプトを自動生成し、タイムラインに共有。

## 4. 主要ユースケース (Use Cases)
1. プロジェクトディレクトリを開き、エディタペインでコード編集しつつ、隣のペインで Claude に質問/生成指示を送る。
2. CLI からテストを実行し、その結果を Claude に渡してデバッグ方針を提案してもらう。
<!-- Git 連携ユースケースは不要のため削除 -->

## 5. コア機能 (Key Features)
-  <!-- (旧仕様) 水平 / 垂直分割、ペインのリサイズ・移動 -->
  - 水平 / 垂直分割、ペインのリサイズ・移動
  - プロセス毎にタブ／セッションを管理
- マルチペイン管理
  - 自動レイアウト (プリセット構成: 横並び・上下分割・グリッドなどをワンショットで生成)
  - 必要最小限のペイン移動・リサイズ操作のみ提供し、ユーザ設定の負荷を軽減
  - 各ペインに複数の Claude Code インスタンスを割り当て、同時並行で利用可能
  - ペイン間でプロンプト／レスポンスを連鎖させるパイプライン機能 (Claude Code A → B → C など)
- 外部エディタ呼び出しサポート
+<!-- (非採用) 外部エディタ呼び出しサポート -->
@@
-   - キーバインド体系
+<!--   キーバインド体系 (非採用) -->
@@
-     - デフォルトは Emacs 風 (Ctrl/Meta ショートカット) を提供
+<!--     デフォルトは Emacs 風 (Ctrl/Meta ショートカット) を提供 (非採用) -->
@@
-     - すべてのコマンド/ショートカットはユーザ定義ファイルで自由に再マップ可能
+<!--     すべてのコマンド/ショートカットはユーザ定義ファイルで自由に再マップ可能 (非採用) -->
+<!-- (非採用)     - すべてのコマンド/ショートカットはユーザ定義ファイルで自由に再マップ可能 -->
- Claude チャット統合
  - ストリーム表示、コードブロックレンダリング
  - プロンプトプリセット ("リファクタリング提案", "テスト生成" など)
- ファイルブラウザ & プロジェクトツリー (オプション)
- ターミナルエミュレーション
- <!-- Git 連携は不要のため削除 -->
- キーバインドカスタマイズ (Emacs/Vim 風)
+ サブエージェント可視化 & コラボレーション
  - すべての Claude Code インスタンス（サブエージェント含む）のプロンプト / レスポンスをタイムラインで一覧表示
  - 会話ログを Markdown / JSON 形式でエクスポートし、チームレビューや QA 資料として共有可能
  - 各メッセージにメタ情報 (モデル名・トークン数・生成時間) を付与しトレーサビリティを確保
  - ログファイルをリモートストレージ (Git リポジトリや社内 KB) に自動保存するオプション
  - 共有モード (読み取り専用) と編集モード (追記・コメント) を切替可能
  - ロール／メンバータグ機能 (pm, dev1, qa1 など) でフィルタ・ハイライトが可能
  - 自動サマリー & ハイライト Bot が各タグの会話を定期集約し、進捗・TODO・懸念点を生成
  - メッセージ単位で `needs-review` `approved` などレビューフラグを付与し、担当者へ通知
  - 外部ツール連携: GitHub Issue/Pull Request, Slack/Teams, Jira などへサマリーやリンクを自動ポスト
  - 権限モード: Broadcast (全ペインへ同報) / Request (タグ指定で質問→回答リダイレクト) をサポート

## 6. 非目標 (Non-Goals)
- フル機能 GUI IDE の代替 (デバッガのブレークポイント可視化など高度 GUI 要素)
- オフラインでの完全動作 (Claude API 通信は必須。ただし一部キャッシュは検討)

## 7. 技術的前提・制約 (Technical Considerations)
- 実装言語: **F# (.NET 8)** + Spectre.Console または Terminal.Gui。
- 対応プラットフォーム: Linux, macOS を第一級サポート (Windows は対象外)。
- 配布形態: まずは .NET 8 のシングルファイル publish による **F# 製単一バイナリ** を優先 (将来的に Homebrew/Scoop/PyPI 対応も検討)。
- Claude API Key 管理: 環境変数 `CLAUDE_API_KEY` または `~/.config/claude-tui/config.toml`。
- API キーは不要（Claude Code CLI 側で認証を処理）。
- 必須依存: ローカルに Claude Code CLI (バージョン要件 TBD) がインストール済みであること。
- 設定管理: 設定ファイルは `~/.config/claude-tui/config.toml` を予定。保存する項目（CLI パスやプロファイル名など）は未確定 (TBD)。

## 8. ヒアリング項目 (Hearing Items)
以下の質問に順次ご回答いただくことで、要件を確定させます。

1. 想定ユーザ・利用シナリオ
   - **回答: 個人開発者向けで確定**
   - **回答: オンライン限定**（Claude Code CLI がクラウドと通信する前提）
2. 必須機能
   - マルチペインのデフォルトレイアウトやキーバインドの理想形は？
   - **回答: モダンな自動レイアウトを提供し、ユーザによるカスタマイズは最小限 (初期状態で快適に利用可能)**
   - プロジェクトブラウザや Git 連携の優先度は？
   <!-- Git 連携に関する優先度質問は削除 -->
3. 技術スタックの希望
   - **回答: 実装言語は F# を採用**
   - 依存ライブラリ候補: Spectre.Console, Terminal.Gui など .NET 向け TUI フレームワーク
4. 対応プラットフォーム
   - Linux（WSL2）、macOS、Windows（PowerShell/CMD）すべてサポートするか？
   - **回答: Windows はサポート対象外 (Linux / macOS のみ)**
   - 配布方法（pip, brew, Scoop, 単一バイナリ等）の希望は？
   - **回答: まずは .NET シングルファイル publish による F# 単一バイナリで配布し、後日パッケージマネージャ対応を検討**
5. セキュリティ・認証
   - Claude API Key は不要（Claude Code CLI 内部で管理）。
   - CLI 用トークンやログイン情報のキャッシュ方式は？
   - **回答: 認証・キャッシュは Claude Code CLI に委任。本ツール側では実装しない**
6. ライセンス / OSS 方針
   - **回答: MIT ライセンスを採用**
   - 外部コントリビューションを受け入れるポリシーは？

## 9. 既知のリスク (Risks)
- TUI フレームワークの安定性: Textual はまだ β 版で大規模利用実績が少ない。

## 10. 未解決事項 / オープンクエスチョン (Open Questions)
以下はヒアリングが必要な項目。確定後、PRD を更新する。

3. Git 連携の実装範囲？
+<!-- Git 連携に関するオープンクエスチョンは削除 -->
4. 依存ライブラリ・実装言語の最終選定？
5. 配布方法と CI/CD の詳細？
6. ライセンス・コントリビューションポリシー確定？

---

> 本ドキュメントは初稿です。ヒアリング結果を反映し次第、順次アップデートします。 
