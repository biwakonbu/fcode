---
inclusion: always
---

# プロダクト開発ガイドライン

## プロダクト概要

fcodeは、Claude Code CLIを核としたAIチーム協働開発環境です。複数のAIエージェントが役割分担して協調し、「ざっくり指示→20分自走→完成確認」のワークフローを実現するTerminal UIアプリケーションです。

## 開発原則

### 必須要件
- **テストファースト**: 新機能は必ずテストケースを先に作成
- **82テストケース維持**: 既存テストの品質を維持・向上
- **CI/CD必須**: 全変更はGitHub Actionsでの自動検証を通過
- **20分自走ルール**: ユーザー指示から20分以内で自動完了を目指す

### コード品質要件
- **F#関数型パラダイム**: 不変データ・純粋関数・型安全性を優先
- **エラーハンドリング**: Result型・Option型による安全な処理
- **非同期処理**: Task・async/awaitの適切な使用
- **リソース管理**: IDisposableの確実な解放（`use`キーワード使用）

## エージェント協調システム

### 9ペインマルチエージェント構成
- **会話ペイン**: ユーザーとの主要インターフェース
- **dev1-3**: 開発実装（フロントエンド・バックエンド・インフラ）
- **qa1-2**: 品質保証（テスト・セキュリティ）
- **ux**: ユーザー体験設計
- **pm**: プロジェクト管理・進捗制御
- **pdm**: プロダクト管理・要件定義

### 協調制御ルール
- **タスク分解**: 複雑な要求は自動的に専門エージェントに分散
- **進捗共有**: リアルタイムでタスク状況を全エージェントが把握
- **品質ゲート**: QAエージェントによる自動品質チェック
- **エスカレーション**: 問題発生時の自動上位エージェント通知

## 実装優先順位

### 現在の開発フォーカス
1. **協調制御システム**: TaskAssignment・QualityGate・Escalation
2. **リアルタイム進捗ダッシュボード**: 全エージェント状況可視化
3. **品質ゲート統合**: 自動品質チェック・承認フロー
4. **エスカレーション管理UI**: 問題対応・意思決定支援

## UI/UX設計原則

- **Terminal.Gui 1.15.0**: 安定機能のみ使用、最新機能は避ける
- **Emacsキーバインド**: 開発者向け効率的操作を提供
- **リアルタイム更新**: エージェント状況の即座反映
- **アクセシビリティ**: カラーテーマ・キーボード操作対応

## 技術制約

### プラットフォーム・依存関係
- **対象OS**: Linux・macOS（Windows対象外）
- **Claude Code CLI**: 必須依存・プロセス分離実装
- **SQLite3**: タスク永続化・ACID保証

### パフォーマンス要件
- **起動時間**: 3秒以内
- **UI応答性**: 100ms以内
- **メモリ使用量**: 256MB以下
- **同時エージェント**: 9プロセス安定動作

## 実装時の注意点

### 新機能開発時
1. 対応するテストケースを先に作成
2. F#の型安全性を最大限活用
3. エラーハンドリングはResult型で統一
4. UIコンポーネントはTerminal.Gui 1.15.0の範囲内で実装

### 既存機能修正時
1. 既存の82テストケースが通ることを確認
2. 破壊的変更は避け、後方互換性を保持
3. パフォーマンス要件を満たすことを検証
